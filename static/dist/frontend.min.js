function scaleTweenUpdate(e){updateScaleRecursive(e)}function updateScaleRecursive(e){for(var t=0;t<e.children.length;t++)updateScaleRecursive(e.children[t]),e.children[t].updateMatrix(),e.children[t].geometry.applyMatrix(e.children[t].matrix),e.children[t].matrix.identity(),console.log(e.children[t].geometry.vertices),e.children[t].geometry.verticesNeedUpdate=!0,console.log(e.children[t].geometry.verticesNeedUpdate)}function init(){"use strict";scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),camera.position.x=5,camera.position.y=5,camera.position.z=5,camera.lookAt(new THREE.Vector3(0,5,0));var e=new THREE.SpotLight(16777215);e.position.set(100,150,10),e.shadow.camera.near=20,e.shadow.camera.far=50,e.castShadow=!0,scene.add(e);var t=new THREE.AmbientLight(16777215);scene.add(t),buildTree(configObj),addStats(),addControls(configObj),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.enableDamping=!0,controls.dampingFactor=.25,controls.enableZoom=!1,controls.target=new THREE.Vector3(0,5,0),controls.autoRotate=!0,controls.autoRotateSpeed=.3,controls.maxPolarAngle=Math.PI/2,controls.enablePan=!1,productivitree.animation.initAnimations(),render()}function buildTree(e){var t=scene.getObjectByName("treeContainer"),n=scene.getObjectByName("twig"),i=scene.getObjectByName("trunk");t&&scene.remove(t),n&&scene.remove(n),i&&scene.remove(i);var a=new Tree({seed:e.seed,segments:e.segments,levels:e.levels,vMultiplier:e.vMultiplier,twigScale:e.twigScale,initalBranchLength:e.initalBranchLength,lengthFalloffFactor:e.lengthFalloffFactor,lengthFalloffPower:e.lengthFalloffPower,clumpMax:e.clumpMax,clumpMin:e.clumpMin,branchFactor:e.branchFactor,dropAmount:e.dropAmount,growAmount:e.growAmount,sweepAmount:e.sweepAmount,maxRadius:e.maxRadius,climbRate:e.climbRate,trunkKink:e.trunkKink,treeSteps:e.treeSteps,taperRate:e.taperRate,radiusFalloffRate:e.radiusFalloffRate,twistRate:e.twistRate,trunkLength:e.trunkLength});treeContainer=new THREE.Object3D;var r=new THREE.Geometry,o=new THREE.Geometry;a.verts.forEach(function(e){r.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),a.vertsTwig.forEach(function(e){o.vertices.push(new THREE.Vector3(e[0],e[1],e[2]))}),a.faces.forEach(function(e){r.faces.push(new THREE.Face3(e[0],e[1],e[2]))}),a.facesTwig.forEach(function(e){o.faces.push(new THREE.Face3(e[0],e[1],e[2]))}),a.facesTwig.forEach(function(e){var t=a.uvsTwig[e[0]],n=a.uvsTwig[e[1]],i=a.uvsTwig[e[2]],r=new THREE.Vector2(t[0],t[1]),c=new THREE.Vector2(n[0],n[1]),s=new THREE.Vector2(i[0],i[1]);o.faceVertexUvs[0].push([r,c,s])}),a.faces.forEach(function(e){var t=a.UV[e[0]],n=a.UV[e[1]],i=a.UV[e[2]],o=new THREE.Vector2(t[0],t[1]),c=new THREE.Vector2(n[0],n[1]),s=new THREE.Vector2(i[0],i[1]);r.faceVertexUvs[0].push([o,c,s])});var c=new THREE.MeshLambertMaterial;c.map=(new THREE.TextureLoader).load("static/textures/leaf.png"),c.doubleSided=!0,c.transparent=!0;var s=new THREE.MeshLambertMaterial,d=(new THREE.TextureLoader).load("static/textures/tree.jpg");d.wrapS=d.wrapT=THREE.RepeatWrapping,s.map=d,r.computeFaceNormals(),o.computeFaceNormals(),r.computeVertexNormals(!0),o.computeVertexNormals(!0),trunkMesh=new THREE.Mesh(r,s),trunkMesh.name="trunk";var l=new THREE.Mesh(o,c);l.name="twig",treeContainer.add(trunkMesh),treeContainer.add(l),treeContainer.name="treeContainer",scene.add(treeContainer)}function render(){renderer.render(scene,camera),stats.update(renderer),TWEEN.update(),controls.update(),requestAnimationFrame(render)}function addStats(){stats=new Stats,stats.setMode(0),stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px",document.body.appendChild(stats.domElement)}function addControls(e){var t=new dat.GUI;t.add(e,"seed").onChange(function(){buildTree(configObj)}),t.add(e,"segments").onChange(function(){buildTree(configObj)}),t.add(e,"levels").onChange(function(){buildTree(configObj)}),t.add(e,"vMultiplier").onChange(function(){buildTree(configObj)}),t.add(e,"twigScale").onChange(function(){buildTree(configObj)}),t.add(e,"initalBranchLength").onChange(function(){buildTree(configObj)}),t.add(e,"lengthFalloffFactor").onChange(function(){buildTree(configObj)}),t.add(e,"lengthFalloffPower").onChange(function(){buildTree(configObj)}),t.add(e,"clumpMax").onChange(function(){buildTree(configObj)}),t.add(e,"clumpMin").onChange(function(){buildTree(configObj)}),t.add(e,"branchFactor").onChange(function(){buildTree(configObj)}),t.add(e,"dropAmount").min(-.5).max(.5).onChange(function(){buildTree(configObj)}),t.add(e,"growAmount").onChange(function(){buildTree(configObj)}),t.add(e,"sweepAmount").onChange(function(){buildTree(configObj)}),t.add(e,"maxRadius").onChange(function(){buildTree(configObj)}),t.add(e,"climbRate").onChange(function(){buildTree(configObj)}),t.add(e,"trunkKink").onChange(function(){buildTree(configObj)}),t.add(e,"treeSteps").onChange(function(){buildTree(configObj)}),t.add(e,"taperRate").onChange(function(){buildTree(configObj)}),t.add(e,"radiusFalloffRate").onChange(function(){buildTree(configObj)}),t.add(e,"twistRate").onChange(function(){buildTree(configObj)}),t.add(e,"radiusFalloffRate").onChange(function(){buildTree(configObj)}),t.add(e,"trunkLength").onChange(function(){buildTree(configObj)})}function resizeHandler(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}productivitree.animation={},productivitree.animation.tweens=function(){return{scale:{},scaleReverse:{},rotation:{},rotateReverse:{}}}(),productivitree.animation.initAnimations=function(){var e=productivitree.animation.tweens,t={initial:{x:.1,y:.1,z:.1},target:{x:1,y:1,z:1}};e.scale=new TWEEN.Tween(t.initial).to(t.target,2e3).easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function(){treeContainer.scale.x=t.initial.x,treeContainer.scale.y=t.initial.y,treeContainer.scale.z=t.initial.z,updateScaleRecursive(treeContainer)})},productivitree.animation.eventHandlers=function(){function e(){t.addEventListener("click",function(){productivitree.animation.tweens.scale.start()})}var t=document.querySelector(".js-play-animation");return{addPlayListener:e}}(),function(){productivitree.animation.eventHandlers.addPlayListener()}(),productivitree.Config=function(){this.seed=200,this.segments=5,this.levels=6,this.vMultiplier=2.5,this.twigScale=.1,this.initalBranchLength=.5,this.lengthFalloffFactor=.8,this.lengthFalloffPower=.9,this.clumpMax=.45,this.clumpMin=.4,this.branchFactor=2.5,this.dropAmount=-.1,this.growAmount=.23,this.sweepAmount=.01,this.maxRadius=.2,this.climbRate=.371,this.trunkKink=.093,this.treeSteps=10,this.taperRate=.947,this.radiusFalloffRate=.73,this.twistRate=3.02,this.trunkLength=2.4,this.update=function(){createTree(control)}};var productivitree={},container=document.getElementById("container"),camera,renderer,scene,controls,stats,treeContainer;productivitree.Config=function(){this.seed=400,this.segments=6,this.levels=5,this.vMultiplier=.6,this.twigScale=.1,this.initalBranchLength=1,this.lengthFalloffFactor=.8,this.lengthFalloffPower=.9,this.clumpMax=.45,this.clumpMin=.4,this.branchFactor=2.5,this.dropAmount=-.1,this.growAmount=.23,this.sweepAmount=.01,this.maxRadius=.2,this.climbRate=.371,this.trunkKink=.093,this.treeSteps=10,this.taperRate=.947,this.radiusFalloffRate=.73,this.twistRate=3.02,this.trunkLength=2.4,this.update=function(){buildTree(this)}};var configObj=new productivitree.Config;window.onload=init,window.addEventListener("resize",resizeHandler,!1),productivitree.transforms=function(e,t,n){return"SCALE"===t.toUpperCase()&&"undefined"==typeof n&&(n={x:.1,y:.1,z:.1}),"SCALE"===t.toUpperCase()?{setScale:function(){e.scale.x=n.x,e.scale.y=n.y,e.scale.z=n.z}}:{setRotate:function(){e.scale.x=n.x,e.scale.y=n.y,e.scale.z=n.z}}};